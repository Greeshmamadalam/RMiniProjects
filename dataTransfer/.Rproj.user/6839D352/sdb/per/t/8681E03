{
    "collab_server" : "",
    "contents" : "require(RMySQL)\nrequire(dplyr)\nkRsocket <- \"/var/run/mysql/mysql.sock\"\nkRUser <- \"kdevdbuser\"\nkRUserPwd <- \"t00rYFWOiRF\"\nkRDatabase <- \"kountable_francine\"\nkRHost <- \"prod-db.clv18hnrncxz.us-west-2.rds.amazonaws.com\"\nkRDBPort <- 3306\n\nconMySql<- dbConnect(dbDriver(\"MySQL\"), user=kRUser, password=kRUserPwd, dbname=kRDatabase, host=kRHost, port=kRDBPort,\n                     unix.socket=socket, client.flag=CLIENT_MULTI_STATEMENTS)\ndb.src_mysql <- src_mysql(kRDatabase, host = kRHost, port = kRDBPort, user = kRUser, password = kRUserPwd)\n\nkRsocket <- \"/var/run/mysql/mysql.sock\"\nkRUser <- \"Analyst1\"\nkRUserPwd <- \"L3tM3w0rk\"\nkRDatabase <- \"kountableBackend_Dev\"\n#kRHost <- \"173.74.198.235\"\nkRHost <- \"47.190.45.73\"\nkRDBPort <- 3306\nsocket <- NULL\n\nconMySql<- dbConnect(dbDriver(\"MySQL\"), user=kRUser, password=kRUserPwd, dbname=kRDatabase, host=kRHost, port=kRDBPort,\n                     unix.socket=socket, client.flag=CLIENT_MULTI_STATEMENTS)\ndb.src_mysql <- src_mysql(kRDatabase, host = kRHost, port = kRDBPort, user = kRUser, password = kRUserPwd)\n\n\nget.mySQLTable <- function(db.src_mysql = NULL, tableName=\"tradeDeals\") {\n  require(dplyr)\n  ## read with dplyr\n  # The code with the %>%  is the long way both versions work\n  # db.src_mysql <- src_mysql(dbname, host = host, port = port, user = user, password = password)\n  tbl.tradeNames <- collect(tbl(db.src_mysql,tableName))\n  # tbl.tradeTransactions <- db.src_mysql %>%\n  #   tbl(table) %>%\n  #   filter(transDealName == Trade) %>%\n  #   collect()\n  \n  return(tbl.tradeNames)\n}\n\ntbl.tradeDeals <- get.mySQLTable(db.src_mysql = db.src_mysql, tableName = \"tradeDeals\")\n\n## test case select just one field to change and keep the id field\ntbl.tradeDeals2 <- tbl.tradeDeals %>% select(deal_id, ClientTelephone)\n## use mutate to get rid of nas\ntbl.tradeDeals2 <- tbl.tradeDeals2 %>% mutate(ClientTelephone = ifelse(is.na(ClientTelephone), '867-5309', ClientTelephone)) %>% rename(ClientTelephone2 = ClientTelephone)\n\n## merge back\ntbl.tradeDeals <- dplyr::left_join(tbl.tradeDeals, tbl.tradeDeals2, by = 'deal_id')\n\ntbl.tradeDeals <- tbl.tradeDeals %>% mutate(ClientTelephone =  ifelse(is.na(ClientTelephone), ClientTelephone2, ClientTelephone)) %>% select(-ClientTelephone2)\n\n## clean up charachter NA values that break dplyr and make sure numeric NAs are NAs\nfor(ci in colnames(tbl.tradeDeals)) {\n  napos <- is.na(tbl.tradeDeals[[ci]])\n  if(any(napos)) {\n    if(is.numeric(tbl.tradeDeals[[ci]])) {\n      tbl.tradeDeals[[ci]][napos] <- NA\n    }\n    if(is.character(tbl.tradeDeals[[ci]])) {\n      tbl.tradeDeals[[ci]][napos] <- ''\n    }\n  }\n}\n\n## Drop old table and create new table\n## drop old table using RMySQL's dbSendQuery\ncat('+++++++++++++++++++++++++++ DROP TABLE tradeDeals +++++++++++++++++++++++\\n')\ndbSendQuery(conMySql, \"DROP TABLE tradeDeals\")\n\n# create table with dyplyr field formats using copy_to\ncat('+++++++++++++++++++++++++++ copy_to tradeDeals +++++++++++++++++++++++\\n')\ncopy_to(db.src_mysql,tbl.tradeDeals, name=\"tradeDeals\", temporary = FALSE)",
    "created" : 1487971205912.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "27|73|39|0|\n",
    "hash" : "195695229",
    "id" : "8681E03",
    "lastKnownWriteTime" : 1487979535,
    "last_content_update" : 1488555209025,
    "path" : "~/Rproject/dataTransfer/joeRmysql.R",
    "project_path" : "joeRmysql.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}